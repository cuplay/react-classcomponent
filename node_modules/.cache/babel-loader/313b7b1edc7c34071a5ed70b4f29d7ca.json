{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"D:\\\\\\u684C\\u9762\\\\\\u524D\\u7AEF\\u5B9E\\u6218\\\\react_admin_client\\\\src\\\\pages\\\\users\\\\index.jsx\";\nimport React, { Component } from 'react';\nimport { PAGE_SIZE } from '../../utils/constant';\nimport { formateDate } from '../../utils/dataUtils';\nimport LinkButton from '../../component/link-button';\nimport { reqUsers } from '../../api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Users extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      users: [],\n      //所有用户列表\n      showStatus: 0,\n      roles: []\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '用户名',\n        dataIndex: 'username'\n      }, {\n        title: '邮箱',\n        dataIndex: 'email'\n      }, {\n        title: '电话',\n        dataIndex: 'phone'\n      }, {\n        title: '注册时间',\n        dataIndex: 'create_time',\n        render: create_time => formateDate(create_time)\n      }, {\n        title: '所属角色',\n        dataIndex: 'role_id',\n        render: role_id => // {\n        //     const role=this.state.roles.find(role=>role._id===role_id)\n        //     return role?role.name:''}\n        //防止反复生成\n        this.roleNames[role_id]\n      }, {\n        title: '操作',\n        render: user => /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n            children: \"\\u4FEE\\u6539\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(LinkButton, {\n            children: \"\\u5220\\u9664\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 47,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 17\n        }, this)\n      }];\n    };\n\n    this.initRoles = roles => {\n      this.roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, []);\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoles(roles); // console.log(roles.find(role=>role._id===\"5ff5ab2fa4aca2121c004675\").name)\n\n        this.setState({\n          users,\n          roles\n        });\n      } else {\n        _message.error('获取角色列表失败');\n      }\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        showStatus: 0\n      });\n    };\n  }\n\n  UNSAFE_componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getUsers();\n  }\n\n  render() {\n    const {\n      users,\n      showStatus\n    } = this.state;\n\n    const title = /*#__PURE__*/_jsxDEV(_Button, {\n      type: \"primary\",\n      onClick: () => {\n        this.setState({\n          showStatus: 1\n        });\n      },\n      children: \"\\u521B\\u5EFA\\u7528\\u6237\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 22\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        rowKey: \"_id\",\n        pagination: {\n          pageSize: PAGE_SIZE // , total: 50\n\n        },\n        dataSource: users,\n        columns: this.columns //   loading={this.state.loading}\n        //   rowSelection={{ type: \"radio\", selectedRowKeys: [role._id] }} //设置单选\n        //   onRow={(role) => {\n        //     return {\n        //       onClick: (event) => {\n        //         this.setState({ role });\n        //       }, // 点击行\n        //       onDoubleClick: (event) => {},\n        //       onContextMenu: (event) => {},\n        //       onMouseEnter: (event) => {}, // 鼠标移入行\n        //       onMouseLeave: (event) => {},\n        //     };\n        //   }}\n        ,\n        bordered: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u6DFB\\u52A0\\u89D2\\u8272\",\n        visible: showStatus === 1,\n        onOk: this.addRole,\n        onCancel: this.handleCancel,\n        destroyOnClose: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["D:/桌面/前端实战/react_admin_client/src/pages/users/index.jsx"],"names":["React","Component","PAGE_SIZE","formateDate","LinkButton","reqUsers","Users","state","users","showStatus","roles","initColumns","columns","title","dataIndex","render","create_time","role_id","roleNames","user","initRoles","reduce","pre","role","_id","name","getUsers","result","status","data","setState","error","handleCancel","UNSAFE_componentWillMount","componentDidMount","pageSize","addRole"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport {Button, Card,Table,Modal, message} from 'antd'\r\nimport {PAGE_SIZE} from '../../utils/constant'\r\nimport { formateDate } from '../../utils/dataUtils'\r\nimport LinkButton from '../../component/link-button'\r\nimport  {reqUsers} from '../../api'\r\nexport default class Users extends Component {\r\n    state = {\r\n        users:[],//所有用户列表\r\n        showStatus:0,\r\n        roles:[]\r\n    }\r\n    initColumns = ()=>{\r\n        this.columns=[\r\n        {\r\n            title:'用户名',\r\n            dataIndex:'username',\r\n        },\r\n        {\r\n            title:'邮箱',\r\n            dataIndex:'email',\r\n        },\r\n        {\r\n            title:'电话',\r\n            dataIndex:'phone',\r\n        },\r\n        {\r\n            title:'注册时间',\r\n            dataIndex:'create_time',\r\n            render: (create_time)=>formateDate(create_time)\r\n        },\r\n        {\r\n            title:'所属角色',\r\n            dataIndex:'role_id',\r\n            render:(role_id) =>\r\n            // {\r\n            //     const role=this.state.roles.find(role=>role._id===role_id)\r\n            //     return role?role.name:''}\r\n            //防止反复生成\r\n            this.roleNames[role_id]\r\n        },\r\n        {\r\n            title:'操作',\r\n            render:(user)=>(\r\n                <span>\r\n                    <LinkButton>修改</LinkButton>\r\n                    <LinkButton>删除</LinkButton>\r\n                </span>\r\n            )\r\n        },\r\n    ]\r\n    }\r\n    /* 根据role数据,生成包含所有角色名的对象 */\r\n    initRoles=(roles)=>{\r\n        \r\n        this.roleNames = roles.reduce((pre,role)=>{\r\n            pre[role._id]=role.name\r\n            return pre\r\n        },[])\r\n    }\r\n    getUsers=async ()=>{\r\n        const result =await  reqUsers()\r\n        if(result.status===0){\r\n      \r\n            \r\n            const {users,roles}= result.data\r\n            this.initRoles(roles)\r\n            // console.log(roles.find(role=>role._id===\"5ff5ab2fa4aca2121c004675\").name)\r\n            this.setState({users,roles})\r\n        }else{\r\n            message.error('获取角色列表失败')\r\n        }\r\n    }\r\n    UNSAFE_componentWillMount(){\r\n        this.initColumns()\r\n    }\r\n    componentDidMount(){\r\n        this.getUsers()\r\n    }\r\n    handleCancel=()=>{\r\n        this.setState({showStatus:0})\r\n    }\r\n    render() {\r\n        const {users,showStatus} = this.state\r\n        const title =<Button type='primary' onClick={()=>{this.setState({showStatus:1})}}>创建用户</Button>\r\n        return (\r\n            <Card title={title}>\r\n        <Table\r\n          rowKey=\"_id\"\r\n          pagination={{\r\n            pageSize: PAGE_SIZE,\r\n            // , total: 50\r\n          }}\r\n          dataSource={users}\r\n          columns={this.columns}\r\n        //   loading={this.state.loading}\r\n        //   rowSelection={{ type: \"radio\", selectedRowKeys: [role._id] }} //设置单选\r\n        //   onRow={(role) => {\r\n        //     return {\r\n        //       onClick: (event) => {\r\n        //         this.setState({ role });\r\n        //       }, // 点击行\r\n        //       onDoubleClick: (event) => {},\r\n        //       onContextMenu: (event) => {},\r\n        //       onMouseEnter: (event) => {}, // 鼠标移入行\r\n        //       onMouseLeave: (event) => {},\r\n        //     };\r\n        //   }}\r\n          bordered\r\n        />\r\n        <Modal\r\n          title=\"添加角色\"\r\n          visible={showStatus === 1}\r\n          onOk={this.addRole}\r\n          onCancel={this.handleCancel}\r\n          destroyOnClose={true}\r\n        >\r\n          \r\n        </Modal>\r\n        {/* <Modal\r\n          title=\"设置角色权限\"\r\n          visible={showStatus === 2}\r\n          onOk={this.setRole}\r\n          onCancel={this.handleCancel}\r\n          destroyOnClose={true}\r\n        >\r\n          <SetTree role={role} ref={this.auth}/>\r\n        </Modal> */}\r\n      </Card>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}