{"ast":null,"code":"import \"antd/es/card/style/css\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"D:\\\\desk\\\\\\u5C1A\\u7845\\u8C37React\\u5168\\u6808\\u9879\\u76EE\\u3010\\u8C37\\u7C92\\u540E\\u53F0\\u3011\\u6559\\u7A0B\\\\React-admin\\\\src\\\\pages\\\\users\\\\index.jsx\";\nimport React, { Component } from \"react\";\nimport { PAGE_SIZE } from \"../../utils/constant\";\nimport { formateDate } from \"../../utils/dataUtils\";\nimport LinkButton from \"../../component/link-button\";\nimport { reqDelUser, reqUsers } from \"../../api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Users extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      users: [],\n      //所有用户列表\n      showStatus: 0,\n      roles: []\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: \"用户名\",\n        dataIndex: \"username\"\n      }, {\n        title: \"邮箱\",\n        dataIndex: \"email\"\n      }, {\n        title: \"电话\",\n        dataIndex: \"phone\"\n      }, {\n        title: \"注册时间\",\n        dataIndex: \"create_time\",\n        render: create_time => formateDate(create_time)\n      }, {\n        title: \"所属角色\",\n        dataIndex: \"role_id\",\n        render: role_id => // {\n        //     const role=this.state.roles.find(role=>role._id===role_id)\n        //     return role?role.name:''}\n        //防止反复生成\n        this.roleNames[role_id]\n      }, {\n        title: \"操作\",\n        render: user => /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(LinkButton, {\n            children: \"\\u4FEE\\u6539\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 46,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(LinkButton, {\n            onClick: () => this.deleteUser(user),\n            children: \"\\u5220\\u9664\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 47,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 11\n        }, this)\n      }];\n    };\n\n    this.initRoles = roles => {\n      this.roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name ? role.name : \"\";\n        return pre;\n      }, []);\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: `确认删除${user.username}吗?`,\n        onOk: async () => {\n          const result = await reqDelUser(user._id);\n\n          if (result.status === 0) {\n            _message.success(\"删除用户成功!\");\n\n            this.getUsers();\n          } else {\n            _message.error(\"删除用户失败!\");\n          }\n        }\n      });\n    };\n\n    this.getUsers = async () => {\n      const result = await reqUsers();\n\n      if (result.status === 0) {\n        const {\n          users,\n          roles\n        } = result.data;\n        this.initRoles(roles); // console.log(roles.find(role=>role._id===\"5ff5ab2fa4aca2121c004675\").name)\n\n        this.setState({\n          users,\n          roles\n        });\n      } else {\n        _message.error(\"获取角色列表失败\");\n      }\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        showStatus: 0\n      });\n    };\n  }\n\n  UNSAFE_componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getUsers();\n  }\n\n  render() {\n    const {\n      users,\n      showStatus\n    } = this.state;\n\n    const title = /*#__PURE__*/_jsxDEV(_Button, {\n      type: \"primary\",\n      onClick: () => {\n        this.setState({\n          showStatus: 1\n        });\n      },\n      children: \"\\u521B\\u5EFA\\u7528\\u6237\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(_Card, {\n      title: title,\n      children: [/*#__PURE__*/_jsxDEV(_Table, {\n        rowKey: \"_id\",\n        pagination: {\n          pageSize: PAGE_SIZE // , total: 50\n\n        },\n        dataSource: users,\n        columns: this.columns //   loading={this.state.loading}\n        //   rowSelection={{ type: \"radio\", selectedRowKeys: [role._id] }} //设置单选\n        //   onRow={(role) => {\n        //     return {\n        //       onClick: (event) => {\n        //         this.setState({ role });\n        //       }, // 点击行\n        //       onDoubleClick: (event) => {},\n        //       onContextMenu: (event) => {},\n        //       onMouseEnter: (event) => {}, // 鼠标移入行\n        //       onMouseLeave: (event) => {},\n        //     };\n        //   }}\n        ,\n        bordered: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_Modal, {\n        title: \"\\u6DFB\\u52A0\\u89D2\\u8272\",\n        visible: showStatus === 1,\n        onOk: this.addUser,\n        onCancel: this.handleCancel,\n        destroyOnClose: true,\n        children: /*#__PURE__*/_jsxDEV(UserForm, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["D:/desk/尚硅谷React全栈项目【谷粒后台】教程/React-admin/src/pages/users/index.jsx"],"names":["React","Component","PAGE_SIZE","formateDate","LinkButton","reqDelUser","reqUsers","Users","state","users","showStatus","roles","initColumns","columns","title","dataIndex","render","create_time","role_id","roleNames","user","deleteUser","initRoles","reduce","pre","role","_id","name","confirm","username","onOk","result","status","success","getUsers","error","data","setState","handleCancel","UNSAFE_componentWillMount","componentDidMount","pageSize","addUser"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Button, Card, Form,Table, Modal, message } from \"antd\";\r\nimport { PAGE_SIZE } from \"../../utils/constant\";\r\nimport { formateDate } from \"../../utils/dataUtils\";\r\nimport LinkButton from \"../../component/link-button\";\r\nimport { reqDelUser, reqUsers } from \"../../api\";\r\nexport default class Users extends Component {\r\n  state = {\r\n    users: [], //所有用户列表\r\n    showStatus: 0,\r\n    roles: [],\r\n  };\r\n  initColumns = () => {\r\n    this.columns = [\r\n      {\r\n        title: \"用户名\",\r\n        dataIndex: \"username\",\r\n      },\r\n      {\r\n        title: \"邮箱\",\r\n        dataIndex: \"email\",\r\n      },\r\n      {\r\n        title: \"电话\",\r\n        dataIndex: \"phone\",\r\n      },\r\n      {\r\n        title: \"注册时间\",\r\n        dataIndex: \"create_time\",\r\n        render: (create_time) => formateDate(create_time),\r\n      },\r\n      {\r\n        title: \"所属角色\",\r\n        dataIndex: \"role_id\",\r\n        render: (role_id) =>\r\n          // {\r\n          //     const role=this.state.roles.find(role=>role._id===role_id)\r\n          //     return role?role.name:''}\r\n          //防止反复生成\r\n          this.roleNames[role_id],\r\n      },\r\n      {\r\n        title: \"操作\",\r\n        render: (user) => (\r\n          <span>\r\n            <LinkButton>修改</LinkButton>\r\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\r\n          </span>\r\n        ),\r\n      },\r\n    ];\r\n  };\r\n  /* 根据role数据,生成包含所有角色名的对象 */\r\n  initRoles = (roles) => {\r\n    this.roleNames = roles.reduce((pre, role) => {\r\n      pre[role._id] = role.name ? role.name : \"\";\r\n      return pre;\r\n    }, []);\r\n  };\r\n  /* 删除指定用户 */\r\n  deleteUser = (user) => {\r\n    Modal.confirm({\r\n      title: `确认删除${user.username}吗?`,\r\n\r\n      onOk: async () => {\r\n        const result = await reqDelUser(user._id);\r\n        if (result.status === 0) {\r\n          message.success(\"删除用户成功!\");\r\n          this.getUsers()\r\n        } else {\r\n          message.error(\"删除用户失败!\");\r\n        }\r\n      },\r\n    });\r\n  };\r\n  /* 获取用户列表 */\r\n  getUsers = async () => {\r\n    const result = await reqUsers();\r\n    if (result.status === 0) {\r\n      const { users, roles } = result.data;\r\n      this.initRoles(roles);\r\n      // console.log(roles.find(role=>role._id===\"5ff5ab2fa4aca2121c004675\").name)\r\n      this.setState({ users, roles });\r\n    } else {\r\n      message.error(\"获取角色列表失败\");\r\n    }\r\n  };\r\n  UNSAFE_componentWillMount() {\r\n    this.initColumns();\r\n  }\r\n  componentDidMount() {\r\n    this.getUsers();\r\n  }\r\n  handleCancel = () => {\r\n    this.setState({ showStatus: 0 });\r\n  };\r\n  render() {\r\n    const { users, showStatus } = this.state;\r\n    const title = (\r\n      <Button\r\n        type=\"primary\"\r\n        onClick={() => {\r\n          this.setState({ showStatus: 1 });\r\n        }}\r\n      >\r\n        创建用户\r\n      </Button>\r\n    );\r\n    return (\r\n      <Card title={title}>\r\n        <Table\r\n          rowKey=\"_id\"\r\n          pagination={{\r\n            pageSize: PAGE_SIZE,\r\n            // , total: 50\r\n          }}\r\n          dataSource={users}\r\n          columns={this.columns}\r\n          //   loading={this.state.loading}\r\n          //   rowSelection={{ type: \"radio\", selectedRowKeys: [role._id] }} //设置单选\r\n          //   onRow={(role) => {\r\n          //     return {\r\n          //       onClick: (event) => {\r\n          //         this.setState({ role });\r\n          //       }, // 点击行\r\n          //       onDoubleClick: (event) => {},\r\n          //       onContextMenu: (event) => {},\r\n          //       onMouseEnter: (event) => {}, // 鼠标移入行\r\n          //       onMouseLeave: (event) => {},\r\n          //     };\r\n          //   }}\r\n          bordered\r\n        />\r\n        <Modal\r\n          title=\"添加角色\"\r\n          visible={showStatus === 1}\r\n          onOk={this.addUser}\r\n          onCancel={this.handleCancel}\r\n          destroyOnClose={true}\r\n        >\r\n            <UserForm></UserForm>\r\n        </Modal>\r\n        {/* <Modal\r\n          title=\"设置角色权限\"\r\n          visible={showStatus === 2}\r\n          onOk={this.setRole}\r\n          onCancel={this.handleCancel}\r\n          destroyOnClose={true}\r\n        >\r\n          <SetTree role={role} ref={this.auth}/>\r\n        </Modal> */}\r\n      </Card>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}